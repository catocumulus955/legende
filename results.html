<!DOCTYPE html>
<html lang="no">
<head>
  <meta charset="UTF-8" />
  <title>Resultater – Legendeløpet</title>
  <link href="https://fonts.googleapis.com/css2?family=Lato&display=swap" rel="stylesheet" />
  <style>
  
    body {
      margin: 0;
      font-family: 'Lato', sans-serif;
      background: #f9f9f9;
      color: #333;
    }

    .banner {
      background-color: #ffdb58;
      padding: 1rem 2rem;
      position: sticky;
      top: 0;
      z-index: 1000;
      text-align: center;
    }

    .banner h1 {
      margin: 0;
      font-size: 2rem;
    }

    .buttons {
      display: flex;
      justify-content: center;
      gap: 1rem;
      margin: 1rem 0;
      flex-wrap: wrap;
    }

    button {
      background-color: #333;
      color: white;
      padding: 0.6rem 1rem;
      border: none;
      border-radius: 5px;
      font-size: 1rem;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }

    button:hover {
      background-color: #555;
    }
	
	.back-button {
	  text-align: right;
	  margin: 1rem 2rem;
	}
	.back-button .btn {
	  background-color: #333;
	  color: white;
	  padding: 0.6rem 1rem;
	  text-decoration: none;
	  border-radius: 5px;
	  font-size: 1rem;
	  display: inline-block;
	  transition: background-color 0.3s ease;
	}

	.back-button .btn:hover {
	  background-color: #555;
	}

    table {
      width: 90%;
      margin: 2rem auto;
      border-collapse: collapse;
    }

    th, td {
      padding: 0.6rem;
      border: 1px solid #ccc;
      text-align: center;
    }

    th {
      background-color: #eee;
    }
	
	.banner {
	  background-color: #ffdb58;
	  padding: 1rem 2rem;
	  position: sticky;
	  top: 0;
	  z-index: 1000;
	  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
	}

	.banner-inner {
	  display: flex;
	  justify-content: space-between;
	  align-items: center;
	  flex-wrap: wrap;
	  text-align: center;
	}

	.banner-left {
	  flex: 1;
	  text-align: left;
	  min-width: 200px;
	}

	.banner-center {
	  flex: 1;
	  text-align: center;
	  min-width: 200px;
	}

	.banner-right {
	  flex: 1;
	  display: flex;
	  flex-direction: column;
	  align-items: flex-end;
	  justify-content: center;
	  text-align: right;
	  gap: 0.5rem;
	  min-width: 200px;
	}

	.event-title {
	  font-size: 1.2rem;
	  font-weight: 600;
	  margin: 0 0 0.2rem 0;
	  color: #222;
	}

	.event-date,
	.event-location {
	  font-size: 1rem;
	  margin: 0.2rem 0;
	  font-weight: 400;
	  color: #444;
	}

	.banner-center h1 {
	  font-size: 2.5rem;
	  margin: 0;
	  font-weight: 800;
	  color: #222;
	}

	#timer {
	  font-size: 1.2rem;
	  font-weight: bold;
	  margin-bottom: 0.5rem;
	  color: #333;
	}

	.btn {
	  background-color: #333;
	  color: white;
	  padding: 0.6rem 1rem;
	  text-decoration: none;
	  border-radius: 5px;
	  font-size: 1rem;
	  transition: background-color 0.3s ease;
	}

	.btn:hover {
	  background-color: #555;
	}

	@media (max-width: 600px) {
	  .banner-inner {
		flex-direction: column;
		align-items: center;
		text-align: center;
	  }

	  .banner-left,
	  .banner-center,
	  .banner-right {
		text-align: center;
		align-items: center;
	  }

	  .banner-right {
		align-items: center;
	  }
	}
  </style>
</head>
	<script>
	  function countdown() {
		const targetDate = new Date("2025-12-20T10:00:00");
		const now = new Date();
		const diff = targetDate - now;

		if (diff <= 0) {
		  document.getElementById("timer").innerText = "Løpet har startet!";
		  return;
		}

		const days = Math.floor(diff / (1000 * 60 * 60 * 24));
		const hours = Math.floor((diff / (1000 * 60 * 60)) % 24);
		const minutes = Math.floor((diff / (1000 * 60)) % 60);
		const seconds = Math.floor((diff / 1000) % 60);

		document.getElementById("timer").innerText =
		  `${days} dager ${hours}t ${minutes}m ${seconds}s`;
	  }

	  setInterval(countdown, 1000);
	</script>
<body>
  <div class="banner">
	  <div class="banner-inner">
		<div class="banner-left">
		  <p class="event-title">Legendeløpet 2025</p>
		  <p class="event-date">Lørdag 20. Desember</p>
		  <p class="event-location">Mosvannet 10:00</p>
		</div>

		<div class="banner-center">
		  <h1>Resultater</h1>
		</div>

		<div class="banner-right">
		  <div id="timer"></div>
		  <a href="index.html" class="btn">← Tilbake til forsiden</a>
		</div>
	  </div>
	</div>

  <main>
    <div class="buttons">
      <button data-year="all">Alle tider</button>
      <button data-year="2022">2022</button>
      <button data-year="2023">2023</button>
      <button data-year="2024">2024</button>
    </div>

    <div id="results"></div>
  </main>

 
 <!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
  // 1. Firebase Configuration and Initialization
 const firebaseConfig = {
    apiKey: "AIzaSyCfaUa6FEEj55L8YqdKTe5YE3mMLHqDBW4",
    authDomain: "legendelopet-resultat.firebaseapp.com",
    projectId: "legendelopet-resultat",
    storageBucket: "legendelopet-resultat.appspot.com", // ✅ fix typo here
    messagingSenderId: "982148824748",
    appId: "1:982148824748:web:878a9fb9d58f93d564a909",
    measurementId: "G-QMF0EKMT47"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();


  // 2. Utility Functions
  function calculatePace(time) {
    const [min, sec] = time.split(":").map(Number);
    const totalSec = min * 60 + sec;
    const pace = totalSec / 3;
    const paceMin = Math.floor(pace / 60);
    const paceSec = Math.round(pace % 60);
    return `${paceMin}:${paceSec.toString().padStart(2, '0')}`;
  }

  function timeToSeconds(time) {
    const [min, sec] = time.split(":").map(Number);
    return min * 60 + sec;
  }

  // 3. Main Display Function
  function showTab(year, data) {
	  const container = document.getElementById("results");
	  container.innerHTML = "";

	  let filtered = data;

	  if (year === "all") {
	  filtered = [...data].sort((a, b) => a.allRank - b.allRank);
	}

	  if (filtered.length === 0) {
		container.innerHTML = "<p>Ingen resultater funnet for dette året.</p>";
		return;
	  }

	  // For year-specific view, assign rank and pace
	  if (year !== "all") {
		filtered = [...filtered]
		  .sort((a, b) => timeToSeconds(a.time_display) - timeToSeconds(b.time_display))
		  .map((r, i) => ({
			...r,
			pace: calculatePace(r.time_display),
			rank: i + 1
		  }));
	  }

	  const headers = year === "all"
		? ["Plassering (All Time)", "Navn", "Tid", "Fart", "År", "Plassering det året"]
		: ["Plassering", "Navn", "Tid", "Fart"];

	  const table = document.createElement("table");
	  const thead = document.createElement("thead");
	  const tbody = document.createElement("tbody");

	  const headerRow = document.createElement("tr");
	  headers.forEach(h => {
		const th = document.createElement("th");
		th.innerText = h;
		headerRow.appendChild(th);
	  });
	  thead.appendChild(headerRow);

	  filtered.forEach(r => {
		const row = document.createElement("tr");
		const cells = year === "all"
		  ? [r.allRank, r.name, r.time_display, r.pace, r.year, r.rank]
		  : [r.rank, r.name, r.time_display, r.pace];

		cells.forEach((c, i) => {
		  const td = document.createElement("td");
		  if (headers[i] === "Navn" && r.athlete_id) {
			td.innerHTML = `<a href="#" onclick="showAthlete('${r.athlete_id}')">${c}</a>`;
		  } else {
			td.innerText = c;
		  }
		  row.appendChild(td);
		});

		tbody.appendChild(row);
	  });

	  table.appendChild(thead);
	  table.appendChild(tbody);
	  container.appendChild(table);
	}

  // 4. Fetch Data from Firestore
  let allResults = [];

  db.collection("results").get()
	  .then(snapshot => {
		snapshot.forEach(doc => {
		  allResults.push(doc.data());
		});

		// ✅ Sort full list and assign allRank + pace
		const sortedAll = [...allResults]
		  .sort((a, b) => timeToSeconds(a.time_display) - timeToSeconds(b.time_display));

		sortedAll.forEach((r, i) => {
		  r.allRank = i + 1;
		  r.pace = calculatePace(r.time_display);
		});

		showTab("all", allResults);
	  })
	  .catch(error => {
		console.error("Firestore fetch error:", error);
		document.getElementById("results").innerHTML = "<p>Kunne ikke hente resultater.</p>";
	  });

  // 5. Wire Up Buttons
  document.querySelectorAll("button").forEach(btn => {
    btn.addEventListener("click", () => {
      const year = btn.getAttribute("data-year");
      showTab(year, allResults);
    });
  });

  // 6. Optional: Athlete Detail View
  function showAthlete(id) {
    const athleteResults = allResults.filter(r => r.athlete_id === id);
    showTab("all", athleteResults); // or create a custom view
  }
</script>
...
<div id="results"></div>
</main>
</body>
</html>